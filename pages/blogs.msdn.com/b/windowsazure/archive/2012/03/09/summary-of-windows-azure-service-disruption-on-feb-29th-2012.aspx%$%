<!doctype html>

<!--[if (lt IE 7)&!(IEMobile)]><html lang="en-US" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html lang="en-US" class="no-js lt-ie9 lt-ie8"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html lang="en-US" class="no-js lt-ie9"><![endif]-->
<!--[if gt IE 8]><!--> <html lang="en-US" class="no-js"><!--<![endif]-->

	<head>
		<meta charset="utf-8">

				<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<title>Summary of Windows Azure Service Disruption on Feb 29th, 2012 | Microsoft Azure Blog</title>

				<meta name="HandheldFriendly" content="True">
		<meta name="MobileOptimized" content="320">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

				<!-- <link rel="apple-touch-icon" href="http://azure.microsoft.com/blog/wp-content/themes/azure/library/images/apple-icon-touch.png"> -->
		<link rel="icon" href="http://azure.microsoft.com/blog/wp-content/themes/azure/favicon.png?v=3">
		<!--[if IE]>
			<link rel="shortcut icon" href="http://azure.microsoft.com/blog/wp-content/themes/azure/favicon.ico?v=3">
		<![endif]-->
				<meta name="msapplication-TileColor" content="#f01d4f">
		<!-- <meta name="msapplication-TileImage" content="http://azure.microsoft.com/blog/wp-content/themes/azure/library/images/win8-tile-icon.png"> -->

		<link rel="pingback" href="http://azure.microsoft.com/blog/xmlrpc.php">

				<link rel="alternate" type="application/rss+xml" title="Microsoft Azure Blog &raquo; Feed" href="http://azure.microsoft.com/blog/feed/" />
<link rel="alternate" type="application/rss+xml" title="Microsoft Azure Blog &raquo; Comments Feed" href="http://azure.microsoft.com/blog/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Microsoft Azure Blog &raquo; Summary of Windows Azure Service Disruption on Feb 29th, 2012 Comments Feed" href="http://azure.microsoft.com/blog/2012/03/09/summary-of-windows-azure-service-disruption-on-feb-29th-2012/feed/" />
<link rel='stylesheet' id='bones-stylesheet-css'  href='http://azure.microsoft.com/blog/wp-content/themes/azure/library/css/style.css' type='text/css' media='all' />
<!--[if (lt IE 9)&!(IEMobile)]>
<link rel='stylesheet' id='bones-old-ie-css'  href='http://azure.microsoft.com/blog/wp-content/themes/azure/library/css/ie.css' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://azure.microsoft.com/blog/wp-includes/js/comment-reply.min.js'></script>
<script type='text/javascript' src='http://azure.microsoft.com/blog/wp-content/themes/azure/library/js/libs/custom.modernizr.js'></script>
<script type='text/javascript' src='http://azure.microsoft.com/blog/wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='http://azure.microsoft.com/blog/wp-includes/js/jquery/jquery-migrate.min.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://azure.microsoft.com/blog/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://azure.microsoft.com/blog/wp-includes/wlwmanifest.xml" /> 
<link rel='canonical' href='http://azure.microsoft.com/blog/2012/03/09/summary-of-windows-azure-service-disruption-on-feb-29th-2012/' />
<link rel='shortlink' href='http://azure.microsoft.com/blog/?p=123161' />
		
		<style type="text/css">html.lt-ie9{display:none;}</style>
		<script type="text/javascript">
			Modernizr.addTest('cssremunit', function() {
				var div = document.createElement('div');
				try {
					div.style.fontSize = '3rem';
				}
				catch( er ) {}
				return (/rem/).test(div.style.fontSize);
			});
			Modernizr.load({
				test: Modernizr.mq('only all'),
				nope: 'http://azure.microsoft.com/blog/wp-content/themes/azure/library/js/libs/respond.min.js',
				complete : function () {
					document.getElementsByTagName("html")[0].style.display = 'block';

					Modernizr.load({
						test: Modernizr.cssremunit,
						nope: 'http://azure.microsoft.com/blog/wp-content/themes/azure/library/js/libs/rem.min.js'
					});
			    }
			});
		</script>

		<!-- Start Visual Website Optimizer Asynchronous Code -->
		<script type='text/javascript'>
			var _vwo_code=(function(){
			var account_id=65836,
			settings_tolerance=2000,
			library_tolerance=2500,
			use_existing_jquery=false,
			// DO NOT EDIT BELOW THIS LINE
			f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
		</script>
		<!-- End Visual Website Optimizer Asynchronous Code -->

		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-47764989-4', 'blog.azure.com');
			ga('require', 'linkid', 'linkid.js');
			ga('send', 'pageview');
		</script>
	</head>

	<body class="single single-post postid-123161 single-format-standard">
		<div id="fb-root"></div>
		<div id="container">

			<header class="header" role="banner">

				<div id="inner-header" class="wrap clearfix">

					<div class="row">
						
						<div class="medium-4 large-4 column">
														<a class="logo" href="http://azure.microsoft.com/blog" rel="nofollow"><img 
								src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_logo.png" 
								alt="Microsoft Azure Blog"
								width="165" 
								height="21"></a>
							<h1>Blog</h1>
						</div>

						<div class="medium-8 large-8 column text-align-right">

							<div class="top-right-area clearfix">
								<nav role="navigation">
																		<ul class="clearfix">
										<li><a target="_blank" href="http://www.windowsazure.com/en-us/account/">ACCOUNT</a></li>
										<li><a target="_blank" href="https://manage.windowsazure.com/">PORTAL</a></li>
									</ul>
								</nav>
								
								<div class="resp-button-row clearfix">
									<a href="/" class="btn-resp-menu">Menu</a>
								
									<div class="search-area">
																		
											<div id="search-6" class="widget widget_search"><form class="clearfix" role="search" method="get" id="searchform" action="http://azure.microsoft.com/blog/" >
	<label class="screen-reader-text" for="s">Search for:</label>
	<div class="search-container clearfix"><input type="text" value="" name="s" id="s" placeholder="Search" />
	<input type="submit" id="searchsubmit" value="" /></div>
	</form></div>								
																			</div>
								</div>
							</div>
						</div>
					</div>

															
					
					
									</div>

			</header>

			<div class="resp-menu-container" style="display:none">
				<div class="sidebar">
				
					<div id="text-3" class="widget widget_text">			<div class="textwidget"><a href="/blog/feed/" target="_blank" class="btn-subscribe button small">Subscribe</a></div>
		</div><div id="categories-3" class="widget widget_categories"><h4 class="widgettitle">Topics</h4>		<ul>
	<li class="cat-item cat-item-21"><a href="http://azure.microsoft.com/blog/topics/announcements/" title="View all posts filed under Announcements">Announcements</a> (581)
</li>
	<li class="cat-item cat-item-31"><a href="http://azure.microsoft.com/blog/topics/big-data/" title="View all posts filed under Big Data">Big Data</a> (150)
</li>
	<li class="cat-item cat-item-151"><a href="http://azure.microsoft.com/blog/topics/cloud-strategy/" title="View all posts filed under Cloud Strategy">Cloud Strategy</a> (179)
</li>
	<li class="cat-item cat-item-191"><a href="http://azure.microsoft.com/blog/topics/database-and-storage/" title="View all posts filed under Database and Storage">Database and Storage</a> (157)
</li>
	<li class="cat-item cat-item-61"><a href="http://azure.microsoft.com/blog/topics/developer/" title="View all posts filed under Developer">Developer</a> (138)
</li>
	<li class="cat-item cat-item-171"><a href="http://azure.microsoft.com/blog/topics/identity-access-management/" title="View all posts filed under Identity and Access Management">Identity and Access Management</a> (44)
</li>
	<li class="cat-item cat-item-161"><a href="http://azure.microsoft.com/blog/topics/it-pro-devops/" title="View all posts filed under IT Pro/ Devops">IT Pro/ Devops</a> (55)
</li>
	<li class="cat-item cat-item-181"><a href="http://azure.microsoft.com/blog/topics/mobile/" title="View all posts filed under Mobile">Mobile</a> (25)
</li>
	<li class="cat-item cat-item-211"><a href="http://azure.microsoft.com/blog/topics/networking/" title="View all posts filed under Networking">Networking</a> (24)
</li>
	<li class="cat-item cat-item-201"><a href="http://azure.microsoft.com/blog/topics/virtual-machines/" title="View all posts filed under Virtual Machines">Virtual Machines</a> (56)
</li>
	<li class="cat-item cat-item-221"><a href="http://azure.microsoft.com/blog/topics/web/" title="View all posts filed under Web">Web</a> (66)
</li>
		</ul>
</div><div id="nav_menu-3" class="widget widget_nav_menu"><h4 class="widgettitle">Blogs to follow</h4><div class="menu-blogs-to-follow-container"><ul id="menu-blogs-to-follow" class="menu"><li id="menu-item-25591" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25591"><a target="_blank" href="http://weblogs.asp.net/scottgu/">Scott Guthrie</a></li>
<li id="menu-item-25601" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25601"><a target="_blank" href="http://channel9.msdn.com/shows/Cloud+Cover/">Cloud Cover</a></li>
<li id="menu-item-25611" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25611"><a target="_blank" href="http://blogs.technet.com/b/server-cloud/">Cloud OS</a></li>
</ul></div></div><div id="text-2" class="widget widget_text">			<div class="textwidget"><div class="archive-area">
<a href="/blog/archives/">Archives</a>
<div class="social-links clearfix">
						<a class="link-fb" href="http://www.facebook.com/microsoftazure" target="_blank" title="Facebook">
							<img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_facebook_white.png" width="7" height="15" alt=""/>
						</a>
						<a class="link-tw" href="http://twitter.com/azure" target="_blank" title="Twitter">
							<img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_twitter_white.png" width="15" height="13" alt=""/>
						</a>
						<!--<a class="link-rss" href="/feed/rss2/" target="_blank" title="RSS"><img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_RSS_white.png" width="21" height="21" alt=""/></a>-->
					</div>
</div></div>
		</div>
								</div>
			</div>

			<div id="content">

				<div id="inner-content" class="wrap clearfix">

					<div id="main" class="medium-8 column first clearfix" role="main">

						
							
							<article id="post-123161" class="post-123161 post type-post status-publish format-standard hentry category-identity-access-management clearfix no-thumbnail post-detail" role="article" itemscope itemtype="http://schema.org/BlogPosting">

								<header class="article-header">
									<ul id="breadcrumbs"><li><a href="http://azure.microsoft.com/blog">Azure Blog</a></li><li class="separator"> &gt; </li><li><a href="http://azure.microsoft.com/blog/topics/identity-access-management/" title="View all posts in Identity and Access Management" rel="category tag">Identity and Access Management</a></ul>									<span class="post-date">Friday, March 9, 2012</span>

									<h1 class="entry-title single-title" itemprop="headline">Summary of Windows Azure Service Disruption on Feb 29th, 2012</h1>
								</header>

								<section class="author-info">
									<p class="byline vcard clearfix"><img alt='' src='http://1.gravatar.com/avatar/b3d254b1663d2ea7313e4e97e0ea964b?s=62&amp;d=http%3A%2F%2F1.gravatar.com%2Favatar%2Fad516503a11cd5ca435acc9bb6523536%3Fs%3D62&amp;r=G' class='avatar avatar-62 photo' height='62' width='62' /><span class="author"><a href="http://azure.microsoft.com/blog/author/bill-laing/" title="Posts by Bill Laing" rel="author">Bill Laing</a></span><span></span></p>
								</section>

								
							
								
								<section class="entry-content clearfix" itemprop="articleBody">
																		<h3>Introduction</h3>
<p>As a follow-up to my March 1 posting, I want to share the findings of our root cause analysis of the service disruption of February 29th. &nbsp;We know that many of our customers were impacted by this event and we want to be transparent about what happened, what issues we found, how we plan to address these issues, and how we are learning from the incident to prevent a similar occurrence in the future. &nbsp;&nbsp;</p>
<p>Again, we sincerely apologize for the disruption, downtime and inconvenience this incident has caused.&nbsp; We will be proactively issuing a service credit to our impacted customers as explained below.&nbsp; Rest assured that we are already hard at work using our learnings to improve Windows Azure.&nbsp;</p>
<h3>Overview of Windows Azure and the Service Disruption</h3>
<p>Windows Azure comprises many different services, including Compute, Storage, Networking and higher-level services like Service Bus and SQL Azure.&nbsp; This partial service outage impacted Windows Azure Compute and dependent services: Access Control Service (ACS), Windows Azure Service Bus, SQL Azure Portal, and Data Sync Services.&nbsp; It did not impact Windows Azure Storage or SQL Azure.</p>
<p>While the trigger for this incident was a specific software bug, Windows Azure consists of many components and there were other interactions with normal operations that complicated this disruption. There were two phases to this incident. The first phase was focused on the detection, response and fix of the initial software bug.&nbsp; The second phase was focused on the handful of clusters that were impacted due to unanticipated interactions with our normal servicing operations that were underway.&nbsp; Understanding the technical details of the issue requires some background on the functioning of some of the low-level Windows Azure components.</p>
<h3>Fabric Controllers, Agents and Certificates</h3>
<p>In Windows Azure, cloud applications consist of virtual machines running on physical servers in Microsoft datacenters. Servers are grouped into &ldquo;clusters&rdquo; of about 1000 that are each independently managed by a scaled-out and redundant platform software component called the Fabric Controller (FC), as depicted in Figure 1. Each FC manages the lifecycle of applications running in its cluster, provisions and monitors the health of the hardware under its control. It executes both autonomic operations, like reincarnating virtual machine instances on healthy servers when it determines that a server has failed, as well as application-management operations like deploying, updating and scaling out applications. Dividing the datacenter into clusters isolates faults at the FC level, preventing certain classes of errors from affecting servers beyond the cluster in which they occur.</p>
<p align="center"><img src="http://acom.azurecomcdn.net/80C57D/blogmedia/migratedblogimages/2045.Outage1.png" alt="" border="0"></p>
<p align="center"><em>Figure 1. Clusters and Fabric Controllers</em></p>
<p>Part of Windows Azure&rsquo;s Platform as a Service (PaaS) functionality requires its tight integration with applications that run in VMs through the use of a &ldquo;guest agent&rdquo; (GA) that it deploys into the OS image used by the VMs, shown in Figure 2. Each server has a &ldquo;host agent&rdquo; (HA) that the FC leverages to deploy application secrets, like SSL certificates that an application includes in its package for securing HTTPS endpoints, as well as to &ldquo;heart beat&rdquo; with the GA to determine whether the VM is healthy or if the FC should take recovery actions.</p>
<p align="center"><img src="http://acom.azurecomcdn.net/80C57D/blogmedia/migratedblogimages/7824.Outage2.png" alt="" border="0"></p>
<p align="center"><em>Figure 2. Host Agent and Guest Agent Initialization</em></p>
<p>So that the application secrets, like certificates, are always encrypted when transmitted over the physical or logical networks, the GA creates a &ldquo;transfer certificate&rdquo; when it initializes. The first step the GA takes during the setup of its connection with the HA is to pass the HA the public key version of the transfer certificate. The HA can then encrypt secrets and because only the GA has the private key, only the GA in the target VM can decrypt those secrets.</p>
<p>There are several cases that require generation of a new transfer certificate. Most of the time that&rsquo;s only when a new VM is created, which occurs when a user launches a new deployment, when a deployment scales out, or when a deployment updates its VM operating system. The fourth case is when the FC reincarnates a VM that was running on a server it has deemed unhealthy to a different server, a process the platform calls &ldquo;service healing.&rdquo;</p>
<h3>The Leap Day Bug</h3>
<p>When the GA creates the transfer certificate, it gives it a one year validity range. It uses midnight UST of the current day as the <i>valid-from</i> date and one year from that date as the <i>valid-to</i> date. The leap day bug is that the GA calculated the <i>valid-to</i> date by simply taking the current date and adding one to its year. That meant that any GA that tried to create a transfer certificate on leap day set a <i>valid-to</i> date of February 29, 2013, an invalid date that caused the certificate creation to fail.</p>
<p>As mentioned, transfer certificate creation is the first step of the GA initialization and is required before it will connect to the HA. When a GA fails to create its certificates, it terminates. The HA has a 25-minute timeout for hearing from the GA. When a GA doesn&rsquo;t connect within that timeout, the HA reinitializes the VM&rsquo;s OS and restarts it.</p>
<p>If a clean VM (one in which no customer code has executed) times out its GA connection three times in a row, the HA decides that a hardware problem must be the cause since the GA would otherwise have reported an error. The HA then reports to the FC that the server is faulty and the FC moves it to a state called Human Investigate (HI). As part of its standard autonomic failure recovery operations for a server in the HI state, the FC will service heal any VMs that were assigned to the failed server by reincarnating them to other servers. In a case like this, when the VMs are moved to available servers the leap day bug will reproduce during GA initialization, resulting in a cascade of servers that move to HI.</p>
<p>To prevent a cascading software bug from causing the outage of an entire cluster, the FC has an HI threshold, that when hit, essentially moves the whole cluster to a similar HI state. At that point the FC stops all internally initiated software updates and automatic service healing is disabled. This state, while degraded, gives operators the opportunity to take control and repair the problem before it progresses further.</p>
<h3>The Leap Day Bug in Action</h3>
<p>The leap day bug immediately triggered at 4:00PM PST, February 28<sup>th</sup> (00:00 UST February 29<sup>th</sup>) when GAs in new VMs tried to generate certificates. Storage clusters were not affected because they don&rsquo;t run with a GA, but normal application deployment, scale-out and service healing would have resulted in new VM creation. At the same time many clusters were also in the midst of the rollout of a new version of the FC, HA and GA. That ensured that the bug would be hit immediately in those clusters and the server HI threshold hit precisely 75 minutes (3 times 25 minute timeout) later at 5:15PM PST. The bug worked its way more slowly through clusters that were not being updated, but the critical alarms on the updating clusters automatically stopped the updates and alerted operations staff to the problem. They in turn notified on-call FC developers, who researched the cause and at 6:38PM PST our developers identified the bug.</p>
<p>By this time some applications had single VMs offline and some also had multiple VMs offline, but most applications with multiple VMs maintained availability, albeit with some reduced capacity. To prevent customers from inadvertently causing further impact to their running applications, unsuccessfully scaling-out their applications, and fruitlessly trying to deploy new applications, we disabled service management functionality in all clusters worldwide at 6:55PM PST.&nbsp; This is the first time we&rsquo;ve ever taken this step.&nbsp; Service management allows customers to deploy, update, stop and scale their applications but isn&rsquo;t necessary for the continued operation of already deployed applications. However stopping service management prevents customers from modifying or updating their currently deployed applications.&nbsp;</p>
<p>We created a test and rollout plan for the updated GA by approximately 10:00PM PST, had the updated GA code ready at 11:20PM PST, and finished testing it in a test cluster at 1:50AM PST, February 29<sup>th</sup>. In parallel, we successfully tested the fix in production clusters on the VMs of several of our own applications. We next initiated rollout of the GA to one production cluster and that completed successfully at 2:11AM PST, at which time we pushed the fix to all clusters. As clusters were updated we restored service management functionality for them and at 5:23AM PST we announced service management had been restored to the majority of our clusters.</p>
<h3>Secondary Outage</h3>
<p>When service management was disabled, most of the clusters either were already running the latest FC, GA and HA versions or almost done with their rollouts. Those clusters were completely repaired. Seven clusters, however, had just started their rollouts when the bug affected them. Most servers had the old HA/GA combination and some had the new combination, both of which contained the GA leap day bug, as shown below:</p>
<p align="center"><img src="http://acom.azurecomcdn.net/80C57D/blogmedia/migratedblogimages/7416.Outage3.png" alt="" border="0"></p>
<p align="center"><em>Figure 3. Servers running different versions of the HA and GA</em></p>
<p>We took a different approach to repair these seven clusters, which were in a partially updated state.&nbsp; We restored to previous versions of the FC, HA, but with a fixed GA, instead of updating them to the new HA with a fixed new GA. The first step we took was to test the solution by putting the older HA on a server that had previously been updated to the new HA to keep version compatibility with the older GA. The VMs on the server started successfully and appeared to be healthy.</p>
<p>Under normal circumstances when we apply HA and GA updates to a cluster, the update takes many hours because we honor deployment availability constraints called Update Domains (UDs). Instead of pushing the older HA out using the standard deployment functionality, we felt confident enough with the tests to opt for a &ldquo;blast&rdquo; update, which simultaneously updated to the older version the HA on all servers at the same time.</p>
<p>Unfortunately, in our eagerness to get the fix deployed, we had overlooked the fact that the update package we created with the older HA included the networking plugin that was written for the newer HA, and the two were incompatible. The networking plugin is responsible for configuring a VM&rsquo;s virtual network and without its functionality a VM has no networking capability. Our test of the single server had not included testing network connectivity to the VMs on the server, which was not working. Figure 4 depicts the incompatible combination.</p>
<p style="text-align: center;"><img src="http://acom.azurecomcdn.net/80C57D/blogmedia/migratedblogimages/2133.Outage4.png" alt="" border="0"></p>
<p align="center"><em>Figure 4. Servers running the incompatible combination of HA and HA networking plugin</em></p>
<p>At 2:47 AM PST on the 29<sup>th</sup>, we pushed the incompatible combination of components to those seven clusters and every VM, including ones that had been healthy previously, causing them to become disconnected from the network. Since major services such as Access Control Service (ACS) and Windows Azure Service Bus deployments were in those clusters, any application using them was now impacted because of the loss of services on which they depended.</p>
<p>We quickly produced a corrected HA package and at 3:40 AM PST tested again, this time verifying VM connectivity and other aspects of VM health. Given the impact on these seven clusters, we chose to blast out the fix starting at 5:40 AM PST. The clusters were largely operational again by 8:00 AM PST, but a number of servers were in corrupted states as a result of the various transitions. Developers and operations staff worked furiously through the rest of the day manually restoring and validating these servers. As clusters and services were brought back online we provided updates to the dashboard, and posted the last incident update to the Windows Azure dashboard that all Windows Azure services were healthy at 2:15 AM PST, March 1<sup>st</sup>.</p>
<h3>Improving the Service</h3>
<p>After an incident occurs, we take the time to analyze the incident and ways we can improve our engineering, operations and communications.&nbsp; To learn as much as we can, we do the root cause analysis but also follow this up with an analysis of all aspects of the incident.&nbsp; The three truths of cloud computing are: hardware fails, software has bugs and people make mistakes.&nbsp; Our job is to mitigate all of these unpredictable issues to provide a robust service for our customers.&nbsp; By understanding and addressing these issues we will continue to improve the service we offer to our customers.</p>
<p>The analysis is organized into four major areas, looking at each part of the incident lifecycle as well as the engineering process that preceded it:</p>
<ul>
<li><b>Prevention</b> &ndash; how the system can avoid, isolate, and/or recover from failures</li>
<li><b>Detection</b> &ndash; how to rapidly surface failures and prioritize recovery</li>
<li><b>Response</b> &ndash; how to support our customers during an incident</li>
<li><b>Recovery</b> &ndash; how to reduce the recovery time and impact on our customers</li>
</ul>
<h4>Prevention</h4>
<ul>
<li><b>Testing.</b>&nbsp; The root cause of the initial outage was a software bug due to the incorrect manipulation of date/time values.&nbsp; We are taking steps that improve our testing to detect time-related bugs.&nbsp; We are also enhancing our code analysis tools to detect this and similar classes of coding issues, and we have already reviewed our code base.</li>
<li><b>Fault Isolation.</b>&nbsp; The Fabric Controller moved nodes to a Human Investigate (HI) state when their operations failed due to the Guest Agent (GA) bug.&nbsp; It incorrectly assumed the hardware, not the GA, was faulty.&nbsp; We are taking steps to distinguish these faults and isolate them before they can propagate further into the system.</li>
<li><b>Graceful Degradation.</b> &nbsp;We took the step of turning off service management to protect customers&rsquo; already running services during this incident, but this also prevented any ongoing management of their services.&nbsp; We are taking steps to have finer granularity controls to allow disabling different aspects of the service while keeping others up and visible.</li>
</ul>
<h4>Detection</h4>
<ul>
<li><b>Fail Fast.</b>&nbsp; GA failures were not surfaced until 75 minutes after a long timeout.&nbsp; We are taking steps to better classify errors so that we fail-fast in these cases, alert these failures and start recovery.</li>
</ul>
<h4>Response</h4>
<ul>
<li><b>Service Dashboard</b>.&nbsp; The Windows Azure Dashboard is the primary mechanism to communicate individual service health to customers.&nbsp; However the service dashboard experienced intermittent availability issues, didn&rsquo;t provide a summary of the situation in its entirety, and didn&rsquo;t provide the granularity of detail and transparency our customers need and expect.&nbsp;&nbsp;
<ul>
<li><b>Intermittent availability</b>:&nbsp; This dashboard is run on two different internal infrastructures, Windows Azure and Microsoft.com, to deal with the catastrophic failure of either system.&nbsp; It is also geo-replicated to deal with geographic specific incidents.&nbsp; However, the dashboard experienced intermittent availability issues due to exceptionally high volume and fail-over/load balancing that was taking place.&nbsp;&nbsp;&nbsp; We have taken steps to correct this and ensure more robust service in the future.</li>
<li><b>Situation summary</b>: The service dashboard provides information on the health status of 60+ individual services at the sub-region level.&nbsp; While this is valuable in understanding individual service status, the lack of summary information made it difficult for customers to understand the situation holistically.&nbsp; Customers have asked for a summarized view on the dashboard to quickly gain a comprehensive understanding of the scope and severity of the outage.&nbsp; We are taking steps to make this change.</li>
<li><b>Detail and transparency</b>: Although updates are posted on an hourly basis, the status updates were often generic or repeated the information provided in the last couple of hours.&nbsp; Customers have asked that we provide more details and new information on the specific work taking place to resolve the issue.&nbsp; We are committed to providing more detail and transparency on steps we&rsquo;re taking to resolve an outage as well as details on progress and setbacks along the way.</li>
</ul>
</li>
<li><b>Customer Support.&nbsp; </b>During this incident, we had exceptionally high call volumes that led to longer than expected wait times.&nbsp;&nbsp; While we are staffed to handle high call volumes in the event of an outage the intermittent availability of the service dashboard and lack of updates through other communication channels contributed to the increased call volume.&nbsp; We are reevaluating our customer support staffing needs and taking steps to provide more transparent communication through a broader set of channels.</li>
<li><b>Other Communication Channels</b>.&nbsp; A significant number of customers are asking us to better use our blog, Facebook page, and Twitter handle to communicate with them in the event of an incident.&nbsp; They are also asking that we provide official communication through email more quickly in the days following the incident.&nbsp; We are taking steps to improve our communication overall and to provide more proactive information through these vehicles.&nbsp; We are also taking steps to provide more granular tools to customers and support to diagnose problems with their specific services.</li>
</ul>
<h4>Recovery</h4>
<ul>
<li><b>Internal tooling.&nbsp; </b>We developed and modified some of our internal tooling to address this incident.&nbsp; We will continue to invest in our tools to help speed recovery and make recovery from intermediate states more predictable.&nbsp;</li>
<li><b>Dependency priorities.</b>&nbsp; We are also examining our processes to make sure dependencies are factored into recovery to ensure that all Windows Azure infrastructure services, such as ACS and Windows Azure Service Bus, are recovered first to reduce the impact on customers.&nbsp;</li>
<li><b>Visibility.</b>&nbsp; We are looking at how we can provide better visibility into recovery steps and provide customers with visibility into the intermediate progress being made.</li>
</ul>
<h4>Service Credits</h4>
<p>Microsoft recognizes that this outage had a significant impact on many of our customers. We stand behind the quality of our service and our Service Level Agreement (SLA), and we remain committed to our customers.&nbsp; Due to the extraordinary nature of this event, we have decided to provide a 33% credit to all customers of Windows Azure Compute, Access Control, Service Bus and Caching for the entire affected billing month(s) for these services, regardless of whether their service was impacted.&nbsp; These credits will be applied proactively and will be reflected on a billing period subsequent to the affected billing period.&nbsp; Customers who have additional questions can contact <a target="_blank" href="http://www.windowsazure.com/support/?WT.mc_id=cmp_pst001_blg_post0072">support</a> for more information.</p>
<h3>Conclusion</h3>
<p>We will continue to spend time to fully understand all of the issues outlined above and over the coming days and weeks we will take steps to address and mitigate the issues to improve our service.&nbsp; We know that our customers depend on Windows Azure for their services and we take our SLA with customers very seriously.&nbsp; We will strive to continue to be transparent with customers when incidents occur and will use the learning to advance our engineering, operations, communications and customer support and improve our service to you.</p>
<p>Sincerely,</p>
<p>Bill Laing and the Windows Azure Team</p>
								</section>

								<footer class="article-footer clearfix">
									
									<div class="related-posts-container">
																					<!-- <h1>Related posts</h1> -->
																					<!-- <div class="related-posts row"> -->
										
										<!-- <article id="post-123161" class="post-123161 post type-post status-publish format-standard hentry category-identity-access-management clearfix no-thumbnail post-detail" role="article" itemscope itemtype="http://schema.org/BlogPosting">

											<header class="article-header">
												<span class="post-date">Friday, March 9, 2012</span>

												<h3 class="entry-title" itemprop="headline"><a href="http://azure.microsoft.com/blog/2012/03/09/summary-of-windows-azure-service-disruption-on-feb-29th-2012/" rel="bookmark" title="Summary of Windows Azure Service Disruption on Feb 29th, 2012">Summary of Windows Azure Service Disruption on Feb 29th, 2012</a></h3>
											</header>
											<section class="entry-content clearfix">
												<p>Introduction As a follow-up to my March 1 posting, I want to share the findings of our root cause analysis&#8230;</p>
											</section>
										</article> -->

																				</div>
									</div>
									
								</footer>

							</article>

						
						
					</div>

					<div class="medium-1 column clearfix">
					
					</div>

				</div>

				<div class="comments-wide-screen">
					<div class="comments-section wrap clearfix">
						<div id="comments-content" class="medium-9 column first clearfix">
							
<div id="disqus_thread">
    </div>

<script type="text/javascript">
/* <![CDATA[ */
    var disqus_url = 'http://azure.microsoft.com/blog/2012/03/09/summary-of-windows-azure-service-disruption-on-feb-29th-2012/';
    var disqus_identifier = '123161 http://azureblog.azurewebsites.net/?p=123161';
    var disqus_container_id = 'disqus_thread';
    var disqus_domain = 'disqus.com';
    var disqus_shortname = 'windowsazureblog';
    var disqus_title = "Summary of Windows Azure Service Disruption on Feb 29th, 2012";
        var disqus_config = function () {
        var config = this; // Access to the config object
        config.language = '';

        /*
           All currently supported events:
            * preData â€” fires just before we request for initial data
            * preInit - fires after we get initial data but before we load any dependencies
            * onInit  - fires when all dependencies are resolved but before dtpl template is rendered
            * afterRender - fires when template is rendered but before we show it
            * onReady - everything is done
         */

        config.callbacks.preData.push(function() {
            // clear out the container (its filled for SEO/legacy purposes)
            document.getElementById(disqus_container_id).innerHTML = '';
        });
                config.callbacks.onReady.push(function() {
            // sync comments in the background so we don't block the page
            var script = document.createElement('script');
            script.async = true;
            script.src = '?cf_action=sync_comments&post_id=123161';

            var firstScript = document.getElementsByTagName( "script" )[0];
            firstScript.parentNode.insertBefore(script, firstScript);
        });
                    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
    var DsqLocal = {
        'trackbacks': [
        ],
        'trackback_url': "http:\/\/azure.microsoft.com\/blog\/2012\/03\/09\/summary-of-windows-azure-service-disruption-on-feb-29th-2012\/trackback\/"    };
/* ]]> */
</script>

<script type="text/javascript">
/* <![CDATA[ */
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.' + 'disqus.com' + '/embed.js?pname=wordpress&pver=2.74';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
/* ]]> */
</script>
						</div>
					</div>
				</div>

				<div class="sidebar-container">
					<div class="wrap clearfix">
										<div id="sidebar1" class="sidebar medium-3 medium-offset-9 column last clearfix" role="complementary">

					
						<div id="text-3" class="widget widget_text">			<div class="textwidget"><a href="/blog/feed/" target="_blank" class="btn-subscribe button small">Subscribe</a></div>
		</div><div id="categories-3" class="widget widget_categories"><h4 class="widgettitle">Topics</h4>		<ul>
	<li class="cat-item cat-item-21"><a href="http://azure.microsoft.com/blog/topics/announcements/" title="View all posts filed under Announcements">Announcements</a> (581)
</li>
	<li class="cat-item cat-item-31"><a href="http://azure.microsoft.com/blog/topics/big-data/" title="View all posts filed under Big Data">Big Data</a> (150)
</li>
	<li class="cat-item cat-item-151"><a href="http://azure.microsoft.com/blog/topics/cloud-strategy/" title="View all posts filed under Cloud Strategy">Cloud Strategy</a> (179)
</li>
	<li class="cat-item cat-item-191"><a href="http://azure.microsoft.com/blog/topics/database-and-storage/" title="View all posts filed under Database and Storage">Database and Storage</a> (157)
</li>
	<li class="cat-item cat-item-61"><a href="http://azure.microsoft.com/blog/topics/developer/" title="View all posts filed under Developer">Developer</a> (138)
</li>
	<li class="cat-item cat-item-171"><a href="http://azure.microsoft.com/blog/topics/identity-access-management/" title="View all posts filed under Identity and Access Management">Identity and Access Management</a> (44)
</li>
	<li class="cat-item cat-item-161"><a href="http://azure.microsoft.com/blog/topics/it-pro-devops/" title="View all posts filed under IT Pro/ Devops">IT Pro/ Devops</a> (55)
</li>
	<li class="cat-item cat-item-181"><a href="http://azure.microsoft.com/blog/topics/mobile/" title="View all posts filed under Mobile">Mobile</a> (25)
</li>
	<li class="cat-item cat-item-211"><a href="http://azure.microsoft.com/blog/topics/networking/" title="View all posts filed under Networking">Networking</a> (24)
</li>
	<li class="cat-item cat-item-201"><a href="http://azure.microsoft.com/blog/topics/virtual-machines/" title="View all posts filed under Virtual Machines">Virtual Machines</a> (56)
</li>
	<li class="cat-item cat-item-221"><a href="http://azure.microsoft.com/blog/topics/web/" title="View all posts filed under Web">Web</a> (66)
</li>
		</ul>
</div><div id="nav_menu-3" class="widget widget_nav_menu"><h4 class="widgettitle">Blogs to follow</h4><div class="menu-blogs-to-follow-container"><ul id="menu-blogs-to-follow-1" class="menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25591"><a target="_blank" href="http://weblogs.asp.net/scottgu/">Scott Guthrie</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25601"><a target="_blank" href="http://channel9.msdn.com/shows/Cloud+Cover/">Cloud Cover</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25611"><a target="_blank" href="http://blogs.technet.com/b/server-cloud/">Cloud OS</a></li>
</ul></div></div><div id="text-2" class="widget widget_text">			<div class="textwidget"><div class="archive-area">
<a href="/blog/archives/">Archives</a>
<div class="social-links clearfix">
						<a class="link-fb" href="http://www.facebook.com/microsoftazure" target="_blank" title="Facebook">
							<img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_facebook_white.png" width="7" height="15" alt=""/>
						</a>
						<a class="link-tw" href="http://twitter.com/azure" target="_blank" title="Twitter">
							<img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_twitter_white.png" width="15" height="13" alt=""/>
						</a>
						<!--<a class="link-rss" href="/feed/rss2/" target="_blank" title="RSS"><img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_RSS_white.png" width="21" height="21" alt=""/></a>-->
					</div>
</div></div>
		</div>
									</div>					</div>
				</div>


			</div>

			<footer class="footer" role="contentinfo">

				<div id="inner-footer" class="wrap clearfix">
					<div class="row">
						<div class="medium-2 column">
							<div class="social-links clearfix">
								<a class="link-fb" href="http://www.facebook.com/microsoftazure" target="_blank" title="Facebook">
									<img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_facebook_white.png" width="7" height="15" alt="">
								</a>
								<a class="link-tw" href="http://twitter.com/azure" target="_blank" title="Twitter">
									<img src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_twitter_white.png" width="15" height="13" alt="">
								</a>
							</div>
						</div>
					
						<div class="medium-10 column">
							<div class="horizontal-stack">
								<div class="stack-col">
									<nav role="navigation">
										<ul id="menu-footer-links" class="nav footer-nav clearfix"><li id="menu-item-131151" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-131151"><a target="_blank" href="http://www.windowsazure.com/en-us/community/newsletter/subscribe/">Subscribe to the Azure Newsletter</a></li>
<li id="menu-item-25711" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25711"><a target="_blank" href="http://support.microsoft.com/contactus/?ws=mscom">Contact Us</a></li>
<li id="menu-item-25721" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25721"><a target="_blank" href="http://go.microsoft.com/fwlink/p/?linkid=131004">Privacy &#038; Cookies</a></li>
<li id="menu-item-25722" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25722"><a target="_blank" href="http://azure.microsoft.com/en-us/support/legal/website-terms-of-use/">Terms of Use</a></li>
<li id="menu-item-25741" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-25741"><a target="_blank" href="http://go.microsoft.com/fwlink/p/?linkid=222682">Trademarks</a></li>
</ul>									</nav>
								</div>
								<div class="stack-col">
									<div class="source-org copyright">
										<img
											src="http://acom.azurecomcdn.net/80C57D/blogmedia/azure-images/azureblog_logo_microsoft.png" 
											alt="Microsoft"
											width="76" />

										<div>&copy; 2014 Microsoft</div>
									</div>
								</div>
							</div>	
						</div>				
					</div> <!-- end row -->
				</div>

			</footer>

		</div>

				<script type='text/javascript' src='http://azure.microsoft.com/blog/wp-content/themes/azure/library/js/libs/foundation.js'></script>
<script type='text/javascript' src='http://azure.microsoft.com/blog/wp-content/themes/azure/library/js/scripts.js'></script>
		<noscript>
			<style type="text/css">html.lt-ie9{display:block;}</style>
		</noscript>


		<!-- START OF SmartSource Data Collector TAG -->
		<!-- Copyright (c) 1996-2009 WebTrends Inc.  All rights reserved. -->
		<!-- Version: MS.3.0.0 -->
		<script src="http://azure.microsoft.com/blog/wp-content/themes/azure/library/js/libs/wt.js" type="text/javascript"></script>

		<!-- ----------------------------------------------------------------------------------- -->
		<!-- Warning: The two script blocks below must remain inline. Moving them to an external -->
		<!-- JavaScript include file can cause serious problems with cross-domain tracking.      -->
		<!-- ----------------------------------------------------------------------------------- -->
		<script type="text/javascript">
		//<![CDATA[
		var _tag=new WebTrends();
		_tag.dcsid="dcs00sul300000cdu1gsf3yze_6s3e";
		//_tag.fpcdom="";
		_tag.dcsGetId();
		_tag.trackevents=true;
		//]]>>
		</script>

		<script type="text/javascript">
		//<![CDATA[
		// Add custom parameters here.
		//_tag.DCSext.param_name=param_value;
		_tag.dcsCollect();
		//]]>>
		</script>

		<noscript>
		<div><img alt="DCSIMG" id="DCSIMG" width="1" height="1" src="m.webtrends.com/dcs00sul300000cdu1gsf3yze_6s3e/njs.gif?dcsuri=/nojavascript&amp;WT.js=No&amp;WT.tv=MS.3.0.0"/></div>
		</noscript>
		<!-- END OF SmartSource Data Collector TAG -->
	</body>

</html>
